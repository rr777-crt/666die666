<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Лжец и Выстрелы</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .setup-screen, .game-screen {
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .game-screen {
            display: none;
        }
        .player-input {
            margin-bottom: 10px;
        }
        button {
            padding: 10px 15px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .card {
            width: 60px;
            height: 90px;
            background-color: white;
            border: 1px solid black;
            border-radius: 5px;
            display: inline-flex;
            justify-content: center;
            align-items: center;
            margin: 5px;
            cursor: pointer;
        }
        .selected {
            border: 3px solid green;
        }
        .player-area {
            margin: 20px 0;
            padding: 10px;
            border: 1px solid #eee;
        }
        .active-player {
            background-color: #e6f7ff;
        }
    </style>
</head>
<body>
    <div class="setup-screen">
        <h2>Настройка игры</h2>
        <div id="player-inputs">
            <div class="player-input">
                <input type="text" placeholder="Игрок 1" class="player-name">
            </div>
            <div class="player-input">
                <input type="text" placeholder="Игрок 2" class="player-name">
            </div>
        </div>
        <button id="add-player">+ Добавить игрока</button>
        <button id="start-game">Начать игру</button>
    </div>

    <div class="game-screen">
        <div id="players-display"></div>
        <div id="main-card-display"></div>
        <div id="current-player-hand"></div>
        <div>
            <input type="number" id="cards-to-play" min="1" max="3" value="1">
            <button id="play-cards">Положить карты</button>
            <button id="call-lie">Это ложь!</button>
        </div>
        <div id="game-log"></div>
    </div>

<script>
// Игровые переменные
let players = [];
let deck = [];
let currentPlayerIndex = 0;
let mainCardType = '';
let selectedCards = [];
let lastPlayedCards = [];

// Настройка игры
document.getElementById('add-player').addEventListener('click', function() {
    const inputsContainer = document.getElementById('player-inputs');
    if (inputsContainer.children.length >= 4) return;
    
    const newInput = document.createElement('div');
    newInput.className = 'player-input';
    newInput.innerHTML = `<input type="text" placeholder="Игрок ${inputsContainer.children.length + 1}" class="player-name">`;
    inputsContainer.appendChild(newInput);
});

document.getElementById('start-game').addEventListener('click', function() {
    const nameInputs = document.querySelectorAll('.player-name');
    players = [];
    
    nameInputs.forEach(input => {
        if (input.value.trim() === '') {
            alert('Все имена должны быть заполнены!');
            return;
        }
        players.push({
            name: input.value.trim(),
            lives: 4,
            hand: []
        });
    });
    
    if (players.length < 2) {
        alert('Нужно минимум 2 игрока!');
        return;
    }
    
    document.querySelector('.setup-screen').style.display = 'none';
    document.querySelector('.game-screen').style.display = 'block';
    startNewRound();
});

// Игровая логика
function startNewRound() {
    // Создаем колоду
    deck = [];
    const cardTypes = ['king', 'madam', 'ace'];
    
    cardTypes.forEach(type => {
        for (let i = 0; i < 6; i++) {
            deck.push({ type: type });
        }
    });
    
    deck.push({ type: 'joker' }, { type: 'joker' }, { type: 'black' });
    
    // Перемешиваем
    for (let i = deck.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [deck[i], deck[j]] = [deck[j], deck[i]];
    }
    
    // Выбираем основную карту
    mainCardType = cardTypes[Math.floor(Math.random() * cardTypes.length)];
    
    // Раздаем карты
    players.forEach(player => {
        player.hand = [];
        for (let i = 0; i < 5; i++) {
            player.hand.push(deck.pop());
        }
    });
    
    updateGameDisplay();
}

function updateGameDisplay() {
    // Показываем игроков
    const playersDisplay = document.getElementById('players-display');
    playersDisplay.innerHTML = '';
    
    players.forEach((player, index) => {
        const playerElement = document.createElement('div');
        playerElement.className = `player-area ${index === currentPlayerIndex ? 'active-player' : ''}`;
        playerElement.innerHTML = `
            <h3>${player.name} (❤️ ${player.lives})</h3>
        `;
        playersDisplay.appendChild(playerElement);
    });
    
    // Основная карта
    document.getElementById('main-card-display').innerHTML = `
        <div>Основная карта: <strong>${mainCardType}</strong></div>
    `;
    
    // Рука текущего игрока
    const currentPlayer = players[currentPlayerIndex];
    const handDisplay = document.getElementById('current-player-hand');
    handDisplay.innerHTML = '';
    
    currentPlayer.hand.forEach((card, index) => {
        const cardElement = document.createElement('div');
        cardElement.className = `card ${selectedCards.includes(index) ? 'selected' : ''}`;
        cardElement.textContent = card.type;
        cardElement.addEventListener('click', () => toggleCardSelection(index));
        handDisplay.appendChild(cardElement);
    });
}

function toggleCardSelection(index) {
    const position = selectedCards.indexOf(index);
    if (position === -1) {
        selectedCards.push(index);
    } else {
        selectedCards.splice(position, 1);
    }
    updateGameDisplay();
}

document.getElementById('play-cards').addEventListener('click', function() {
    const cardsToPlay = parseInt(document.getElementById('cards-to-play').value);
    const currentPlayer = players[currentPlayerIndex];
    
    if (selectedCards.length !== cardsToPlay) {
        addToLog(`Нужно выбрать ровно ${cardsToPlay} карт!`);
        return;
    }
    
    // Сохраняем сыгранные карты
    lastPlayedCards = selectedCards.map(index => currentPlayer.hand[index]);
    
    // Удаляем карты из руки
    selectedCards.sort((a, b) => b - a).forEach(index => {
        currentPlayer.hand.splice(index, 1);
    });
    
    // Добираем карты
    while (currentPlayer.hand.length < 5 && deck.length > 0) {
        currentPlayer.hand.push(deck.pop());
    }
    
    addToLog(`${currentPlayer.name} кладет ${cardsToPlay} карт как ${mainCardType}`);
    selectedCards = [];
    nextPlayer();
});

document.getElementById('call-lie').addEventListener('click', function() {
    const accuser = players[currentPlayerIndex];
    const targetIndex = (currentPlayerIndex - 1 + players.length) % players.length;
    const target = players[targetIndex];
    
    const isLie = lastPlayedCards.some(card => 
        card.type !== mainCardType && 
        card.type !== 'joker' && 
        card.type !== 'black'
    );
    
    if (lastPlayedCards.some(card => card.type === 'black')) {
        players.forEach(player => player.lives--);
        addToLog("Чёрная карта! Все теряют 1 жизнь!");
    } else if (isLie) {
        target.lives--;
        addToLog(`${accuser.name} прав! ${target.name} теряет жизнь!`);
    } else {
        accuser.lives--;
        addToLog(`${accuser.name} ошибся! Теряет жизнь!`);
    }
    
    checkGameEnd();
    nextPlayer();
});

function nextPlayer() {
    currentPlayerIndex = (currentPlayerIndex + 1) % players.length;
    updateGameDisplay();
}

function checkGameEnd() {
    const alivePlayers = players.filter(player => player.lives > 0);
    if (alivePlayers.length === 1) {
        setTimeout(() => {
            alert(`Игра окончена! Победитель: ${alivePlayers[0].name}`);
            location.reload();
        }, 500);
    }
}

function addToLog(message) {
    const logElement = document.getElementById('game-log');
    logElement.innerHTML += `<div>${message}</div>`;
    logElement.scrollTop = logElement.scrollHeight;
}
</script>
</body>
</html>
